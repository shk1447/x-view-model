<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>IAD (Image Anomaly Detection) </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="IAD (Image Anomaly Detection) ">
    
      <link rel="shortcut icon" href="../favicon.ico">
      <link rel="stylesheet" href="../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../styles/docfx.css">
      <link rel="stylesheet" href="../styles/main.css">
      <meta property="docfx:navrel" content="../toc.html">
      <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>

                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../getting_started/index.html" title="시작하기">시작하기</a>
                      </li>
                      <li>
                          <a href="../development_guide/index.html" title="개발가이드">개발가이드</a>
                      </li>
                      <li>
                          <a href="../api_reference/SaigeVision.Net.Core.V2.html" title="API 레퍼런스">API 레퍼런스</a>
                      </li>
                      <li>
                          <a href="../release_notes/index.html" title="릴리즈 노트">릴리즈 노트</a>
                      </li>
                </ul>            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">

                  <ul class="nav level1">
                    <li class="">
                      <a href="index.html" title="Quick Start" class="">Quick Start</a>
                    </li>
                    <li class="">
                      <a href="classification.html" title="Classification" class="">Classification</a>
                    </li>
                    <li class="">
                      <a href="detection.html" title="Detection" class="">Detection</a>
                    </li>
                    <li class="">
                      <a href="segmentation.html" title="Segmentation" class="">Segmentation</a>
                    </li>
                    <li class="active">
                      <a href="iad.html" title="IAD (Image Anomaly Detection)" class="active">IAD (Image Anomaly Detection)</a>
                    </li>
                    <li class="">
                      <a href="ocr.html" title="OCR" class="">OCR</a>
                    </li>
                    <li class="">
                      <a href="ien.html" title="IEN (Image Enhancement)" class="">IEN (Image Enhancement)</a>
                    </li>
                  </ul>                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="iad-image-anomaly-detection">IAD (Image Anomaly Detection)</h1>

<br>
<p>이 문서는 <code>SaigieVision</code>을 통해 이미지를 'Image Anomaly Detection(이상탐지)' (이하 IAD) 하는 방법에 대해 설명합니다.</p>
<p>여러분이 앞서 제공된 <a href="index.html"><strong>Quick Start</strong></a> 를 끝냈다면, 'IAD'을 수행하는 방법은 그리 어렵지 않습니다.</p>
<p><strong>아래 코드 블럭은 간단하게 IAD(Image Anomaly Detection) 검사 진행 방법에 대해서 설명합니다.</strong></p>
<pre><code class="lang-java">{
    // Prepare
    SrImage srImage = new SrImage(@&quot;..\..\sample.png&quot;);
    string modelPath = @&quot;..\..\model.saigeiad&quot;;
    int gpuIndex = 0;

    // Initialize
    using (var engine = new IADEngine(modelPath, gpuIndex))
    {
        // Model Info
        ModelInfo model = engine.GetModelInfo();

        // Option
        IADOption option = engine.GetInferenceOption();
        option.CalcTime = true;
        option.CalcHeatmap = true;
        option.CalcMask = true;
        option.CalcObject = true;
        option.CalcObjectAreaAndApplyThreshold = true;
        option.CalcObjectScoreAndApplyThreshold = true;
        engine.SetInferenceOption(option);

        // Inspection &amp; Get Result
        IADResult result = engine.Inspection(srImage);
        Console.WriteLine(&quot;RESULT: &quot; + (result.IsNG ? &quot;NG&quot; : &quot;OK&quot;));
        Console.WriteLine($&quot;Anomaly Score:{result.AnomalyScore.Score:N3}&quot;);
        Console.WriteLine($&quot;Max:{result.AnomalyScore.MaxScore:N3}&quot;);
        Console.WriteLine($&quot;Min{result.AnomalyScore.MinScore:N3}&quot;);
        Console.WriteLine($&quot;ImreadTime:{result.InspectionTime.ImreadTime}&quot;);
        Console.WriteLine($&quot;InferenceTime:{result.InspectionTime.InferenceTime}&quot;);
        Console.WriteLine($&quot;PostProcessingTime:{result.InspectionTime.PostProcessingTime}&quot;);
        foreach (var so in result.SegmentedObjects)
        {
            Console.WriteLine($&quot;Name:{so.ClassInfo.Name}&quot;);
            Console.WriteLine($&quot;Area:{so.Area}&quot;);
            Console.WriteLine($&quot;Score:{so.Score}&quot;);
            Console.WriteLine($&quot;Center Point X: ({so.BoundingRotBox.Center.X}&quot;);
            Console.WriteLine($&quot;Center Point Y: ({so.BoundingRotBox.Center.Y}&quot;);
        }
    }

    // optional
    srImage.Dispose();
}
</code></pre>
<h1 id="prepare">Prepare</h1>
<pre><code class="lang-java">    SrImage srImage = new SrImage(@&quot;..\..\sample.png&quot;);
    string modelPath = @&quot;..\..\model.saigeiad&quot;;
    int gpuIndex = 0;
</code></pre>
<p><code>IADEngine</code> 을 사용하기 위해 필요한 모든 데이터를 준비하는 과정입니다. 일반적으로 아래와 같은 3가지를 요구합니다.</p>
<ul>
<li>검사에 사용할 GPU</li>
<li>검사에 사용할 샘플 이미지들</li>
<li>검사에 사용할 모델( .saigeiad 파일)</li>
</ul>
<blockquote>
<p>SaigeVision은 NVIDIA사의 GPU만을 지원하고 있습니다.<br>
GPU Index에 대해서는 <code>명령 프롬프트 (command)</code> 창을 통해 <code>nvidia-smi</code> 명령어를 입력하면 GPU의 index를 확인할 수 있습니다.</p>
</blockquote>
<blockquote>
<p>이미지는 <code>SrImage</code> 객체를 통해 생성 가능합니다. <code>8bit</code>, <code>16bit</code> 형태의 이미지를 <code>GrayScale</code>, <code>RGB</code>, <code>RGBA</code> 형태로 제공이 됩니다.</p>
</blockquote>
<h1 id="initialize">Initialize</h1>
<pre><code class="lang-java">    IADEngine engine = new IADEngine(modelPath, gpuIndex)
</code></pre>
<p><code>IADEngine</code> 생성자에서 <code>.saigeiad</code> 모델파일에 대한 경로와 GPU Index를 매개변수로 설정하여 생성합니다.</p>
<h1 id="model-info-optional">Model Info (Optional)</h1>
<pre><code class="lang-java">    ModelInfo model = engine.GetModelInfo();
</code></pre>
<p><code>ModelInfo</code> 는 <code>.saigeiad</code> 모델 파일에 대한 정보를 확인할 수 있습니다. 일반적으로 아래와 같은 정보를 확인할 수 있습니다.</p>
<ul>
<li>Network Type <em>(어떤 종류의 딥러닝 네트워크를 사용했는지 나타냅니다)</em></li>
<li>Classes Information <em>(클래스 정보입니다. name, color에 대한 정보들을 확인할 수 있습니다.)</em></li>
<li>Developer Version <em>(모델을 학습할 때 사용한 SaigeVision Developer의 버전입니다.)</em></li>
<li>Server Version <em>(모델을 학습할 때 사용한 SaigeVision Developer의 구성 요소 중 서버의 버전입니다.)</em></li>
<li>Module Version <em>(모델을 학습할 때 사용한 SaigeVision Developer의 구성 요소 중 딥러닝 모듈의 버전입니다.)</em></li>
<li>Roi Information <em>(ROI 정보입니다.)</em></li>
<li>Resize Factor <em>(<strong>Segmentation, IEN 전용</strong>, 인풋 이미지에 적용되는 리사이즈 비율입니다. 추론 이미지에도 동일하게 적용됩니다.)</em></li>
<li>Crop Size <em>(<strong>Segmentation, IEN 전용</strong>, 학습 때 사용된 패치의 사이즈입니다. 추론 이미지와는 관련 없습니다)</em></li>
<li>Image Resize <em>(<strong>IAD, CLS 전용</strong>, 인풋 이미지에 적용되는 리사이즈 입니다. 추론 이미지에도 동일하게 적용됩니다)</em></li>
</ul>
<p>자세한 내용은 <a href="../api_reference/SaigeVision.Net.V2.ModelInfo.html"><strong>Model Info</strong></a> 문서를 통하여 확인할 수 있습니다.</p>
<h1 id="option-optional">Option (Optional)</h1>
<pre><code class="lang-java">    IADOption option = engine.GetInferenceOption();
    option.CalcTime = true;
    option.CalcHeatmap = true;
    option.CalcMask = true;
    option.CalcObject = true;
    option.CalcObjectAreaAndApplyThreshold = true;
    option.CalcObjectScoreAndApplyThreshold = true;
    engine.SetInferenceOption(option);
</code></pre>
<p><code>IADOption</code> 에서 <code>GetInferenceOption()</code> 을 통해서 옵션에 대해서 정보를 받을 수 있습니다.<br>
<code>SetInferenceOption()</code> 을 통해서 옵션에 대해서 설정을 할 수 있습니다.<br>
옵션은 아래와 같은 정보들을 설정할 수 있습니다.</p>
<ul>
<li>Calc Time <em>(추론 API 실행에 소요되는 시간을 세분화하여 출력할지 결정합니다.)</em></li>
<li>Batch Size <em>(추론을 한 번 수행할 때 추론하는 이미지의 개수입니다.)</em></li>
<li>Calc Segmented Object <em>(<code>true</code> 로 설정하면 추론 시 <code>segmented object</code>를 계산합니다.)</em></li>
<li>Calc Mask <em>(<code>true</code>로 설정하면 추론 시 이미지 원본과 같은 크기의 <code>mask</code>를 계산합니다.)</em></li>
<li>Calc Heatmap <em>(<code>true</code>로 설정하면 추론 시 이미지 원본과 같은 크기의 <code>heatmap</code>을 계산합니다.)</em></li>
<li>Calc Object Area and Apply Threshold</li>
<li>Calc Object Score and Apply Threshold</li>
<li>Anomaly Score Threshold <em>(이미지 전체를 대표하는 anomaly score가 이 값보다 크면 비정상 이미지로, 작거나 같으면 정상 이미지로 판정합니다.)</em></li>
<li>Heatmap Color Range Min/Max</li>
<li>Object Boundary Threshold</li>
<li>Object Area Threshold</li>
<li>Object Score Threshold</li>
</ul>
<p>자세한 내용은 <a href="../api_reference/SaigeVision.Net.V2.IAD.IADOption.html"><strong>IAD Option</strong></a> 문서를 통하여 확인할 수 있습니다.</p>
<h1 id="inspection">Inspection</h1>
<pre><code class="lang-java">    engine.Inspection(srImage);
</code></pre>
<p>코드에서 볼수 있는 것처럼 'Inspection'을 수행하는 주 함수는 <code>engine.Inspect()</code>입니다. 모든 종류의 Engine들은 이러한 공통의 <code>Inspect()</code> 함수를 보유하고 있습니다. 또한, 다양한 사용을 위해 여러 형태로 중첩 되어 있습니다. 비동기 혹은 다수의 이미지들을 검사하는 등의 여러 시나리오에서 선택적으로 사용할 수 있습니다.</p>
<h1 id="result">Result</h1>
<pre><code class="lang-java">    IADResult result = engine.GetResult();
    Console.WriteLine(&quot;RESULT: &quot; + (result.IsNG ? &quot;NG&quot; : &quot;OK&quot;));
    Console.WriteLine($&quot;Anomaly Score:{result.AnomalyScore.Score:N3}&quot;);
    Console.WriteLine($&quot;Max:{result.AnomalyScore.MaxScore:N3}&quot;);
    Console.WriteLine($&quot;Min{result.AnomalyScore.MinScore:N3}&quot;);
    Console.WriteLine($&quot;ImreadTime:{result.InspectionTime.ImreadTime}&quot;);
    Console.WriteLine($&quot;InferenceTime:{result.InspectionTime.InferenceTime}&quot;);
    Console.WriteLine($&quot;PostProcessingTime:{result.InspectionTime.PostProcessingTime}&quot;);
    foreach (var so in result.SegmentedObjects)
    {
        Console.WriteLine($&quot;Name:{so.ClassInfo.Name}&quot;);
        Console.WriteLine($&quot;Area:{so.Area}&quot;);
        Console.WriteLine($&quot;Score:{so.Score}&quot;);
        Console.WriteLine($&quot;Center Point X: ({so.BoundingRotBox.Center.X}&quot;);
        Console.WriteLine($&quot;Center Point Y: ({so.BoundingRotBox.Center.Y}&quot;);
    }
</code></pre>
<p><code>IADResult</code> 에서 결과에 대한 모든 정보를 확인할 수 있습니다. <code>IAD</code> 의 경우 아래와 같은 정보를 결과로 확인할 수 있습니다. 일부 결과 정보에 대해서는 <code>IADOption</code> 에서 <code>true</code>로 반영해야 정보를 받아올 수 있습니다.</p>
<ul>
<li>IsNG <em>(정상/비정상 판별 결과입니다.)</em></li>
<li>Anomaly Score <em>(이미지의 대표 anomaly score, 최소, 최대값입니다)</em></li>
<li>Segmented Objects <em>(Anomaly Detection을 통해 검출된 영역의 정보를 받아 옵니다.)</em></li>
<li>Mask <em>(Mask 이미지 정보입니다.)</em></li>
<li>Scoremap <em>(Scoremap 이미지 정보입니다.)</em></li>
<li>Heatmap <em>(Heatmap 이미지 정보입니다.)</em></li>
<li>Insepction Time <em>(추론 API 실행에 소요된 시간을 밀리초 단위로 받아 옵니다.)</em></li>
</ul>
<h1 id="optional">Optional</h1>
<pre><code class="lang-java">    srImage.Dispose();
</code></pre>
<p>이 예제에서는 검사에 사용했던 <code>Bitmap</code>들을 더 이상 사용할 곳이 없이게 <code>Dispose()</code> 합니다.</p>
<h1 id="많은-수의-이미지를-한번에-검사">많은 수의 이미지를 한번에 검사</h1>
<p>앞선 예제에서는 '한 장의 이미지'를 검사하는 시나리오에 대해서 살펴보았습니다. 하지만 '많은 수의 이미지'를 한번에 검사하고자 하는 경우에 대해 알아보겠습니다.</p>
<p>샘플 코드에서 몇가지 부분을 수정하여 이 상황을 해결해봅시다.</p>
<p>우선 <code>Bitmap</code>을 배열로 만들어 '많은 수의 이미지' 데이터를 준비합니다. 아래와 같습니다.</p>
<pre><code class="lang-java">    SrImage[] srImages = new SrImage[]
    {
        new SrImage(@&quot;..\...\sample1.png&quot;),
        new SrImage(@&quot;..\...\sample2.png&quot;),
        new SrImage(@&quot;..\...\sample3.png&quot;),
        new SrImage(@&quot;..\...\sample4.png&quot;)
    };
</code></pre>
<p>이후 생성자에서 숨어있던 마지막 인자를 사용할 수 있습니다.</p>
<pre><code class="lang-java">    var engine = new IADEngine(modelPath, gpuIndex, 4)
</code></pre>
<p>마지막 인자는 '최대 이미지 수' 를 의미하며 한번에 (병렬로) 처리할 수 있는 이미지 수를 의미합니다.</p>
<p>큰 값이 설정될수록 GPU 메모리 할당량이 커지므로, 메모리가 부족하다면 작은 수로 설정해 주세요.</p>
<!--
설정된 값보다 많은 수의 이미지를 검사하는 경우, 내부적으로 여러 번의 검사를 수행합니다.
-->
<p>마지막으로 <code>Inspect()</code> 함수가 포함된 라인 이후를 수정합니다. 결과를 받아오는 <code>GetResults()</code> 함수를 복수명으로 변경 후 배열로 받아올 수 있도록 변경합니다.</p>
<pre><code class="lang-java">    IADResult[] results =engine.Inspection(srImages);
</code></pre>
<p>이제 코드를 동작하여 '많은 수의 이미지'를 검사할 수 있습니다.</p>
</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://dev.azure.com/SaigeResearch/SaigeVision/_git/SaigeVision.Net.V2?path=docs/development_guide/iad.md&amp;version=GBmaster&amp;line=1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      
      <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
