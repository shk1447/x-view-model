# Login Flow

> ViewFlow를 활용한 Login 흐름 예제

```tsx live noInline
const { useViewFlow, registViewFlow } = xvm;

type State = {
  name: string;
};

type Action = {
  setName: (payload: string) => void;
};

type Context = State & Action;

type Flow = {
  login: {
    success: {};
    fail: {};
  };
  main: {};
};

const viewFlow = registViewFlow<Context, Flow>(
  {
    name: "",
    setName(payload) {
      this.name = payload;
    },
  },
  {
    login: {
      invoke: async function (context: Context, err: any) {
        console.log(context);
        if (!context.name) {
          throw new Error("");
        }

        // api 요청 로직
      },
      onDone: "#login.success",
      onError: "#login.fail",
    },

    "login.success": {
      invoke: async function (context: Context, err: any) {
        // 성공 후에 대한 처리
      },
      onDone: (context) => {
        return "#main";
      },
      onError: undefined,
    },
    "login.fail": {
      invoke: async function (context: Context, err: any) {
        // fail에 대한 처리 로직
      },
      onDone: undefined,
      onError: undefined,
    },
    main: {
      invoke: async function (context: Context, err: any) {},
      onDone: undefined,
      onError: undefined,
    },
  },
  { deep: true, name: "LoginViewFlow" }
);

const Form = () => {
  const [[state, send], [current, flow]] = useViewFlow(viewFlow, ["user.name"]);

  useEffect(() => {
    if (current == "login.success") {
      // 로그인 성공시
      alert("success");
    } else if (current == "login.fail") {
      // 로그인 실패시
    } else if (current == "main") {
      // 로그인 성공후 메인으로 접근시
    }
  }, [current]);
  return (
    <>
      <p>{current}</p>
      <input
        defaultValue={state.name}
        onChange={(e) => send("setName", e.target.value)}
      />
      <button onClick={() => flow("#login")}>login</button>
    </>
  );
};

render(
  <>
    <Form />
  </>
);
```
